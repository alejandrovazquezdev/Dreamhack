{% extends 'base-template-user.html' %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/ver-sala.css') }}">
{% endblock %}

{% block content %}
    
<div class="app-container">
    
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-avatar">
                <i class="fa-solid fa-user"></i>
            </div>
            <span class="sidebar-username">{{ session.get('user_name', 'Usuario') }}</span>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li><a href="{{ url_for('dashboard') }}"><i class="icon fa-solid fa-house"></i> Inicio</a></li>
                <li><a href="#" onclick="alert('Funcionalidad de ayuda pr贸ximamente. Contacta: soporte@shifting.com'); return false;"><i class="icon fa-solid fa-circle-question"></i> Ayuda</a></li>
                <li><a href="{{ url_for('mis_salas') }}" class="active"><i class="icon fa-solid fa-comments"></i> Mis Salas</a></li> 
                <li><a href="#" onclick="alert('Funcionalidad de facturaci贸n pr贸ximamente'); return false;"><i class="icon fa-solid fa-file-invoice"></i> Facturaci贸n</a></li>
                <li><a href="#" onclick="alert('Funcionalidad de configuraci贸n pr贸ximamente'); return false;"><i class="icon fa-solid fa-gears"></i> Configuraci贸n</a></li>
            </ul>
        </nav>
        <footer class="sidebar-footer">
            <a href="{{ url_for('logout') }}">Cerrar sesi贸n</a>
        </footer>
    </aside>

    <main class="main-content">
        
        <!-- Encabezado del producto -->
        <div class="product-header">
            <div class="product-title">
                <h1>{{ sala.nombre_producto }}</h1>
                <span class="product-price">${{ "%.0f"|format(sala.precio) }}</span>
            </div>
            <div class="product-meta">
                <span class="condition-tag {% if sala.condicion == 'Nuevo' %}new{% else %}used{% endif %}">{{ sala.condicion }}</span>
                <span class="status-tag {% if sala.activa %}active{% else %}inactive{% endif %}">
                    {{ 'Disponible' if sala.activa else 'No disponible' }}
                </span>
            </div>
        </div>

        <!-- Informaci贸n principal -->
        <div class="main-grid">
            <!-- Panel izquierdo - Detalles -->
            <div class="details-panel">
                {% if sala.descripcion %}
                <div class="description-section">
                    <h3>Descripci贸n</h3>
                    <p>{{ sala.descripcion }}</p>
                </div>
                {% endif %}
                
                <div class="seller-info">
                    <h3>Vendedor</h3>
                    <div class="seller-card">
                        <div class="seller-avatar">
                            {{ creador.name[0]|upper }}{{ creador.lastanme[0]|upper }}
                        </div>
                        <div class="seller-details">
                            <h4>{{ creador.name }} {{ creador.lastanme }}</h4>
                            <p>Miembro desde {{ sala.fecha_creacion.strftime('%B %Y') }}</p>
                        </div>
                    </div>
                </div>

                {% if miembros|length > 0 %}
                <div class="participants-section">
                    <h3>Compradores interesados ({{ miembros|length }})</h3>
                    <div class="participants-list">
                        {% for miembro, usuario in miembros %}
                        <div class="participant-item">
                            <div class="participant-avatar">
                                {{ usuario.name[0]|upper }}{{ usuario.lastanme[0]|upper }}
                            </div>
                            <span>{{ usuario.name }} {{ usuario.lastanme }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Panel derecho - Acciones -->
            <div class="actions-panel">
                <div class="share-section">
                    <h3>Compartir esta sala</h3>
                    
                    <div class="share-field">
                        <label>C贸digo de sala</label>
                        <div class="input-group">
                            <input type="text" id="codigo-sala-display" value="{{ sala.codigo }}" readonly>
                            <button class="copy-btn" onclick="copiarTexto('codigo-sala-display')">Copiar</button>
                        </div>
                    </div>

                    <div class="share-field">
                        <label>Enlace directo</label>
                        <div class="input-group">
                            <input type="text" id="link-sala" value="{{ sala.get_link() }}" readonly>
                            <button class="copy-btn" onclick="copiarTexto('link-sala')">Copiar</button>
                        </div>
                    </div>
                </div>

                <div class="transaction-section">
                    {% if not es_creador and not ya_unido and sala.activa %}
                        <form method="POST" action="{{ url_for('unirse_sala', codigo=sala.codigo) }}">
                            <button type="submit" class="btn-primary large">
                                Mostrar inter茅s
                            </button>
                        </form>
                        <p class="disclaimer">Al mostrar inter茅s, podr谩s contactar directamente con el vendedor</p>
                    {% elif ya_unido and not es_creador %}
                        <div class="joined-status">
                            <p class="success-message">Ya mostraste inter茅s en este producto</p>
                            <form method="POST" action="{{ url_for('salir_sala', codigo=sala.codigo) }}">
                                <button type="submit" class="btn-secondary">Retirar inter茅s</button>
                            </form>
                        </div>
                    {% elif es_creador %}
                        <div class="owner-status">
                            <p class="info-message">Esta es tu publicaci贸n</p>
                            <a href="{{ url_for('mis_salas') }}" class="btn-secondary">Ver todas mis publicaciones</a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Navegaci贸n inferior -->
        <div class="bottom-nav">
            <a href="{{ url_for('dashboard') }}" class="nav-btn">
                <i class="fa-solid fa-home"></i>
                Inicio
            </a>
            <a href="{{ url_for('mis_salas') }}" class="nav-btn">
                <i class="fa-solid fa-list"></i>
                Mis publicaciones
            </a>
            <a href="#" onclick="mostrarSoporte(); return false;" class="nav-btn">
                <i class="fa-solid fa-headset"></i>
                Soporte
            </a>
        </div>

    </main>
</div>

<script>
    function mostrarSoporte() {
        const mensaje = ' Opciones de Soporte:\n\n' +
                       '锔 Email: soporte@shifting.com\n' +
                       ' WhatsApp: +52 123 456 7890\n' +
                       ' Horario: Lun-Vie 9:00-18:00';
        alert(mensaje);
    }
    
    function copiarTexto(inputId) {
        const input = document.getElementById(inputId);
        let texto = input.value;
        
        // Copiar al portapapeles
        navigator.clipboard.writeText(texto).then(() => {
            // Mostrar confirmaci贸n visual
            const btn = event.target.closest('button');
            const originalText = btn.textContent;
            
            btn.textContent = 'Copiado';
            btn.style.background = '#10b981';
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = '';
            }, 2000);
            
        }).catch(err => {
            console.error('Error al copiar:', err);
            // Fallback para navegadores que no soportan clipboard API
            input.select();
            document.execCommand('copy');
            
            const btn = event.target.closest('button');
            const originalText = btn.textContent;
            btn.textContent = 'Copiado';
            btn.style.background = '#10b981';
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = '';
            }, 2000);
        });
    }
</script>

{% endblock %}
